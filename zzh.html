<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>武汉小区查询系统</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            justify-content: flex-start; /* 从容器的起始位置开始排列 */
            align-items: flex-start; /* 从容器的起始位置开始排列 */
            flex-wrap: wrap;
        }


        #map {
            flex: 1; /* 占据剩余空间 */
            height: 700px;
        }

        #infoBox {
            display: flex;
            background-color: white;
            position: absolute;
            left: 0;
            top: 0;
            width: 15%;
            height: 30%; /* 保持与地图相同的高度 */
        }
        .table-content {
            display: none; /* 初始时隐藏表格 */
            position: absolute; /* 绝对定位 */
            top: 50%; /* 使表格垂直居中 */
            transform: translateY(-50%); /* 使表格垂直居中 */
            max-height: 700px; /* 表格最大高度为地图的高度 */
            min-height: 350px;
            /*overflow-y: auto; !* 垂直滚动条 *!*/
            z-index: 999; /* 确保表格显示在其他内容上方 */
            background: white;

        }


        #data-table {
            width: 100%; /* 调整表格宽度 */
            max-height: 100%; /* 设置表格最大高度 */
            border-collapse: collapse;
        }

        #data-table th, #data-table td {
            border: 1px solid #dddddd;
            padding: 8px;
            text-align: center;
        }

        #data-table th {
            background-color: #f2f2f2;
        }



        #prev-page {
            background-color: green;
            margin-right: 10px;
            color: white;
            border-radius: 20px; /* 设置圆角半径为按钮高度的一半 */
            padding: 5px 10px; /* 调整按钮内边距以保持椭圆形外观 */
            border: none; /* 去除按钮边框 */
            cursor: pointer;
        }
        #next-page{
            background-color: green;
            margin-left: 10px;
            margin-right: 10px;
            color: white;
            border-radius: 20px; /* 设置圆角半径为按钮高度的一半 */
            padding: 5px 10px; /* 调整按钮内边距以保持椭圆形外观 */
            border: none; /* 去除按钮边框 */
            cursor: pointer;
        }

        #data-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }

        #data-table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /*.pagination {*/
        /*    margin-top: 10px;*/
        /*    position: relative;*/
        /*    display: flex;*/
        /*    justify-content: center;*/
        /*    align-items: center;*/
        /*}*/

        .pagination button {
            /*margin: 0 5px;*/
            padding: 5px 10px;
            border: 1px solid #dddddd;
            background-color: #ffffff;
            cursor: pointer;
        }
        /* 按钮样式 */
        /*.add-button {*/
        /*    padding: 10px 20px;*/
        /*    font-size: 16px;*/
        /*    border: none;*/
        /*    border-radius: 5px;*/
        /*    background-color: mediumpurple;*/
        /*    color: white;*/
        /*    cursor: pointer;*/
        /*    margin-right: 10px;*/
        /*}*/
        .chuansong {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: dodgerblue;
            color: white;
            cursor: pointer;
            margin-right: 10px;
        }

        /*.add-button:hover {*/
        /*    background-color: purple;*/
        /*}*/
        .chuansong:hover{
            background-color:blue;
        }
        /* 输入框样式 */
        input[type="text"] {
            padding: 8px;
            margin-right: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* 下拉菜单样式 */
        select {
            position: absolute;
            top: 130px; /* 调整按钮距离顶部的距离 */
            right: 10px; /* 调整按钮距离右侧的距离 */
            width: 100px; /* 按钮宽度 */
            height: 30px; /* 按钮高度 */
            /* border-radius: 50%; 变成圆形 */
            background-color: mediumpurple; /* 紫色背景 */
            z-index: 999; /* 确保按钮位于地图之上 */
            color: white; /* 文本颜色 */
            font-size: 20px; /* 文本大小 */
            border: none; /* 移除按钮边框 */
            cursor: pointer; /* 鼠标指针形状 */
        }

        /* 距离信息样式 */
        .distance-info {
            font-size: 16px;
            margin-right: 10px;
        }

        /* 容器样式 */
        /*.container {*/
        /*  display: flex;*/
        /*  justify-content: center;*/
        /*  align-items: center;*/
        /*  flex-wrap: wrap;*/
        /*}*/

        /* 分隔符间距 */
        .container > * {
            margin-bottom: 10px;
        }

        .pagination button:hover {
            background-color: #f2f2f2;
        }

        .action-buttons button {
            margin-right: 5px;
            padding: 8px 15px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .action-buttons button:hover {
            background-color: #45a049;
        }
        /*.add-button {*/
        /*//margin-top: 5px;*/
        /*//margin-bottom: 10px;*/
        /*  background-color: #45a049;*/
        /*}*/

        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px; /* 增加内边距 */
            margin-left: 650px;
            border: 1px solid #888;
            margin-top: 10px;
            width: 30%;
            height: 50%; /* Could be more or less, depending on screen size */
            z-index: 9999;
        }
        .add-marker-btn {
            position: absolute;
            top: 50px; /* 调整按钮距离顶部的距离 */
            right: 10px; /* 调整按钮距离右侧的距离 */
            width: 30px; /* 按钮宽度 */
            height: 30px; /* 按钮高度 */
            border-radius: 50%; /* 变成圆形 */
            background-color: mediumpurple; /* 紫色背景 */
            z-index: 999; /* 确保按钮位于地图之上 */
            color: white; /* 文本颜色 */
            font-size: 20px; /* 文本大小 */
            border: none; /* 移除按钮边框 */
            cursor: pointer; /* 鼠标指针形状 */
        }
        .add-echarts-btn{
            position: absolute;
            top: 90px; /* 调整按钮距离顶部的距离 */
            right: 10px; /* 调整按钮距离右侧的距离 */
            width: 30px; /* 按钮宽度 */
            height: 30px; /* 按钮高度 */
            border-radius: 50%; /* 变成圆形 */
            background-color: mediumpurple; /* 紫色背景 */
            z-index: 999; /* 确保按钮位于地图之上 */
            color: white; /* 文本颜色 */
            font-size: 20px; /* 文本大小 */
            border: none; /* 移除按钮边框 */
            cursor: pointer; /* 鼠标指针形状 */
        }
        .add-re-btn{
            position: absolute;
            top: 130px; /* 调整按钮距离顶部的距离 */
            right: 10px; /* 调整按钮距离右侧的距离 */
            width: 30px; /* 按钮宽度 */
            height: 30px; /* 按钮高度 */
            border-radius: 50%; /* 变成圆形 */
            background-color: mediumpurple; /* 紫色背景 */
            z-index: 999; /* 确保按钮位于地图之上 */
            color: white; /* 文本颜色 */
            font-size: 20px; /* 文本大小 */
            border: none; /* 移除按钮边框 */
            cursor: pointer; /* 鼠标指针形状 */
        }
        .add-marker-btn1 {
            position: absolute;
            top: 100px; /* 调整按钮距离顶部的距离 */
            right: 10px; /* 调整按钮距离右侧的距离 */
            width: 30px; /* 按钮宽度 */
            height: 30px; /* 按钮高度 */
            border-radius: 50%; /* 变成圆形 */
            background-color: mediumpurple; /* 紫色背景 */
            z-index: 999; /* 确保按钮位于地图之上 */
            color: white; /* 文本颜色 */
            font-size: 20px; /* 文本大小 */
            border: none; /* 移除按钮边框 */
            cursor: pointer; /* 鼠标指针形状 */
        }
        /*.chart-container {*/
        /*    width: 400px; !* 图表容器宽度 *!*/
        /*    height: 300px; !* 图表容器高度 *!*/
        /*    position: absolute;*/
        /*    top: 100px; !* 图表容器距离顶部的距离 *!*/
        /*    right: 10px; !* 图表容器距离右侧的距离 *!*/
        /*    border: 1px solid #ccc; !* 图表容器边框 *!*/
        /*}*/
        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@3.3.1/dist/ol-layerswitcher.js"></script>
    <!-- 引入 OpenLayers 库 -->
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>
    <!-- 引入 ol-layerswitcher 库 -->
    <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@3.3.1/dist/ol-layerswitcher.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@3.3.1/dist/ol-layerswitcher.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@6.9.0/dist/ol.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=QzL7Q1ss7GlBZvIeXoIsvL4DbjGDUSNO"></script>
    <script src="https://unpkg.com/ol-echarts/dist/ol-echarts.js"></script>



    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/openlayers/dist/ol.css"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/openlayers/dist/ol.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol3-echarts/dist/ol3Echarts.js"></script>

    <script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.5.0/files/dist/echarts.min.js"></script>

    <!--   Uncomment this line if you want to dataTool extension-->
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.5.0/files/dist/extension/dataTool.min.js"></script>

    <!--  Uncomment this line if you want to use gl extension-->
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts-gl/2/files/dist/echarts-gl.min.js"></script>

    <!--  Uncomment this line if you want to echarts-stat extension-->
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts-stat/latest/files/dist/ecStat.min.js"></script>

    <!--  Uncomment this line if you want to use map-->
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts/4.9.0/files/map/js/china.js"></script>
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts/4.9.0/files/map/js/world.js"></script>

    <!--  Uncomment these two lines if you want to use bmap extension-->
      <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=hjqgxZicWBBHs7pD4BoUhXBHze7sj2bI"></script>
      <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.5.0/files/dist/extension/bmap.min.js"></script>
    
</head>

<body>
<button id="add-marker-btn" class="add-marker-btn">+</button>

<button id="add-echarts-btn" class="add-echarts-btn">+</button>

<button id="add-re-btn" class="add-re-btn">+</button>

<div id="selectTu">
    <select id="layerSelect" onchange="changeLayer()">
        <option value="">选择图层</option>
    </select>
</div>

<div id="pie-chart-container"  style="display: none;"></div>


<div class="container">
    <div id="map"></div>
    <div id="infoBox"></div>
</div>
<div class="table-content">
    <table id="data-table">
        <thead>
        <tr>
            <th>社区名</th>
            <th>经度</th>
            <th>纬度</th>
            <th>操作</th> <!-- 新添加的列 -->
        </tr>
        </thead>
        <tbody id="data-table-body">
        </tbody>
    </table>
<!--        <button class="add-button" id="add-button">增加小区</button> &lt;!&ndash; 新增加的按钮 &ndash;&gt;-->
<!--        <div style="margin-bottom: 10px;margin-top: 10px">图层切换：-->
<!--            <select id="layerSelect" onchange="changeLayer()">-->
<!--                <option value="">选择图层</option>-->
<!--            </select>-->
<!--        </div>-->

        <!-- <div id="layerSwitcher" class="ol-control"></div> -->

<!--        传送目的地：<input type="text" id="location-input" placeholder="输入目的地">-->
<!--        &lt;!&ndash; Button to trigger geolocation &ndash;&gt;-->
<!--        <button onclick="flyToDestination()" style="margin-bottom: 5px" class="chuansong">传送</button>-->
<!--        <h4>点击地图两个点测量距离：</h4>-->
<!--        <div id="distance-info" class="distance-info" s></div>-->

    <div class="pagination">
        <button id="prev-page">Previous</button>
        <span>Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
        <button id="next-page">&nbsp &nbsp Next &nbsp &nbsp</button>
        <span> <select id="items-per-page">
        <option value="5" selected>5</option>
        <option value="8" >8</option>
    </select> </span>
    </div>
</div>
<!--<div class="pagination">-->
<!--    <button id="prev-page">Previous</button>-->
<!--    <span>Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>-->
<!--    <button id="next-page">&nbsp &nbsp Next &nbsp &nbsp</button>-->
<!--    <span>Show <select id="items-per-page">-->
<!--        <option value="5">5</option>-->
<!--        <option value="10" selected>10</option>-->
<!--    </select> items per page</span>-->
<!--</div>-->

<!-- The Modal -->
<div id="editModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>编辑位置信息</h2>
        <form id="editForm">
            <div style="margin-bottom: 50px">
                <label for="editCommunity">社区名:</label>
                <input type="text" id="editCommunity" name="editCommunity">
            </div>
            <div style="margin-bottom: 50px">
                <label for="editLongitude">经度:</label>
                <input type="text" id="editLongitude" name="editLongitude">
            </div>
            <div style="margin-bottom: 50px">
                <label for="editLatitude">纬度:</label>
                <input type="text" id="editLatitude" name="editLatitude">
            </div>
            <button type="submit" class="chuansong">保存</button>
        </form>
    </div>

</div>

<!-- The Modal for adding new location -->
<div id="addModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>增加新的小区信息</h2>
        <form id="addForm">
            <div style="margin-bottom: 50px">
                <label for="addCommunity">社区名:</label>
                <input type="text" id="addCommunity" name="addCommunity">
            </div>
            <div style="margin-bottom: 50px">
                <label for="addLongitude">经度:</label>
                <input type="text" id="addLongitude" name="addLongitude">
            </div >
            <div style="margin-bottom: 50px">
                <label for="addLatitude">纬度:</label>
                <input type="text" id="addLatitude" name="addLatitude">
            </div>
            <button type="submit" class="chuansong">保存</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ol@6.9.0/dist/ol.js"></script>
<script type="text/javascript">
  var tianditu_token = '76d3f7cf5446ca392ecde77bf851e00e'; // 填入您的token
  var locations = []; // To store all locations data
  var currentPage = 1;
  var distance;
  var itemsPerPage = 5;
  var selectedFeature = null;
  var originalStyle = null;
  var editedLocationId = null;
  var featureArray = [];
  var locationInput="武汉";
  var src_loc='http://39.101.71.83';
  // var src_loc='http://localhost';

  // 创建一个单一的图层组合天地图矢量图层和注记图层，因为这两个地图层分开显示没有必要
  var tiandituLayer = new ol.layer.Group({
    title: "天地图",
    layers: [
      new ol.layer.Tile({
        title: "天地图矢量图层",
        source: new ol.source.XYZ({
          url: "http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
          wrapX: false
        })
      }),
      new ol.layer.Tile({
        title: "天地图矢量注记图层",
        source: new ol.source.XYZ({
          url: "http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
          wrapX: false
        })
      })
    ]
  });

  //地图图层绘制
  var map = new ol.Map({
    target:'map',
    layers:[
      new ol.layer.Tile({
        title: "天地图矢量图层",
        source: new ol.source.XYZ({
          url: "http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
          wrapX: false
        })
      }),
      new ol.layer.Tile({
        title: "天地图矢量注记图层",
        source: new ol.source.XYZ({
          url: "http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
          wrapX: false
        })
      }),
      // tiandituLayer,
      new ol.layer.Tile({
        title: "天地图卫星图层",
        source: new ol.source.XYZ({
          url: "http://t0.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
          wrapX: false
        })
      }),
      new ol.layer.Tile({
        title: "街道图层",
        source: new ol.source.OSM()
      }),
      new ol.layer.Tile({
        title: "Bing卫星图层",
        source: new ol.source.BingMaps({
          key: 'AuyckHLenczLROqmFJEo21sIFL8UxWiJUZylaEDWh9oA4-wjc_Qg1veJ0y5tcezn',
          imagerySet: 'AerialWithLabels'
        })
      })
    ],
    view: new ol.View({
      projection: 'EPSG:3857',
      center: [12718773.43,3570249.00],
      zoom: 12,
    })
  });

  var overviewLayers = [
    new ol.layer.Tile({
      title: "天地图矢量图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    new ol.layer.Tile({
      title: "天地图矢量注记图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    // tiandituLayer,
    new ol.layer.Tile({
      title: "天地图卫星图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    new ol.layer.Tile({
      title: "街道图层",
      source: new ol.source.OSM()
    }),
    new ol.layer.Tile({
      title: "Bing卫星图层",
      source: new ol.source.BingMaps({
        key: 'AuyckHLenczLROqmFJEo21sIFL8UxWiJUZylaEDWh9oA4-wjc_Qg1veJ0y5tcezn',
        imagerySet: 'AerialWithLabels'
      })
    })
  ];

  var overmapLayers = [
    new ol.layer.Tile({
      title: "天地图矢量图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    new ol.layer.Tile({
      title: "天地图矢量注记图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    // tiandituLayer,
    new ol.layer.Tile({
      title: "天地图卫星图层",
      source: new ol.source.XYZ({
        url: "http://t0.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=" + tianditu_token,
        wrapX: false
      })
    }),
    new ol.layer.Tile({
      title: "街道图层",
      source: new ol.source.OSM()
    }),
    new ol.layer.Tile({
      title: "Bing卫星图层",
      source: new ol.source.BingMaps({
        key: 'AuyckHLenczLROqmFJEo21sIFL8UxWiJUZylaEDWh9oA4-wjc_Qg1veJ0y5tcezn',
        imagerySet: 'AerialWithLabels'
      })
    })
  ];

  var overviewMapControl = new ol.control.OverviewMap({
    // 设置缩略图的图层
    // layers: [
    //   new ol.layer.Tile({
    //     source: new ol.source.OSM() // 这里可以使用其他图层
    //   })
    // ],
    layers:overviewLayers,
    // 设置缩略图的位置
    collapsed: false
  });
  map.addControl(overviewMapControl);


  var overviewMap = new ol.control.OverviewMap({
    layers:overmapLayers,
    // 设置鹰眼的位置和大小
    view: new ol.View({
      center: [0, 0],
      zoom: 0
    })
  });

  map.addControl(overviewMap);

  // 添加全屏控件
  var fullScreenControl = new ol.control.FullScreen();
  map.addControl(fullScreenControl);
  // Flight animation function
  var startPoint = null;
  var endPoint = null;
  var lineFeature = null;
  var planeFeature = null;
  var flySpeed = 0.1;
  function addPoint(coordinate, isStartPoint) {
    var pointStyle = new ol.style.Style({
      image: new ol.style.Circle({
        radius: 6,
        fill: new ol.style.Fill({
          color: isStartPoint ? 'green' : 'red'
        }),
        stroke: new ol.style.Stroke({
          color: 'white',
          width: 2
        })
      })
    });

    var point = new ol.Feature({
      geometry: new ol.geom.Point(coordinate)
    });
    point.setStyle(pointStyle);

    var vectorSource = new ol.source.Vector({
      features: [point]
    });

    var vectorLayer = new ol.layer.Vector({
      source: vectorSource
    });

    map.addLayer(vectorLayer);

    return point;
  }
  var addMarkerBtn = document.getElementById('add-marker-btn');
  // 获取表格内容元素
  var tableContent = document.querySelector('.table-content');

  // 添加点击事件处理程序
  addMarkerBtn.addEventListener('click', function() {
      // 切换表格的显示状态
      if (tableContent.style.display === 'none') {
          tableContent.style.display = 'block';
          addMarkerBtn.textContent = '-'; // 当表格显示时，按钮文本变成减号
      } else {
          tableContent.style.display = 'none';
          addMarkerBtn.textContent = '+'; // 当表格隐藏时，按钮文本变成加号
      }
  });

  //添加热力图显示处理程序。
  var addReBtn=document.getElementById('add-re-btn');
  var reLayer = null; // 声明一个全局变量来保存 ECharts 图层实例
  var reLayerVisible = false; // 声明一个变量来跟踪图层的显示状态
  addReBtn.addEventListener('click',function(){

    var ROOT_PATH = 'https://echarts.apache.org/examples';
    var option;

    $.get( 'China.json', function (data) {
        if(!reLayerVisible) {
            var points = [].concat.apply(
                [],
                data.map(function(track) {
                    return track.children.map(function(city) {
                        return [parseFloat(city.log), parseFloat(city.lat), 1];
                    });
                })
            );
            console.log("points->", points);
            option = {
                animation: false,
                bmap: {
                    center: [120.13066322374, 30.240018034923],
                    zoom: 14,
                    roam: true
                },
                visualMap: {
                    show: false,
                    top: 'top',
                    min: 0,
                    max: 5,
                    seriesIndex: 0,
                    calculable: true,
                    inRange: {
                        color: ['blue', 'blue', 'green', 'yellow', 'red']
                    }
                },
                series: [
                    {
                        type: 'heatmap',
                        coordinateSystem: 'bmap',
                        data: points,
                        pointSize: 5,
                        blurSize: 6
                    }
                ]
            };
            addReBtn.textContent = '-'; // 当表格隐藏时，按钮文本变成加号
            reLayer = new ol3Echarts(option);
            reLayer.appendTo(map);
            reLayerVisible = true; // 设置图层显示状态为 true
        }else
        {
            reLayer.remove();
            reLayerVisible = false; // 设置图层显示状态为 false

            addReBtn.textContent = '+'; // 当表格显示时，按钮文本变成减号
        }
        });
});










  var echartslayer = new ol3Echarts(getOption());
  echartslayer.appendTo(map)
  function getOption () {
      var geoCoordMap = {
          '上海': [121.4648, 31.2891],
          '东莞': [113.8953, 22.901],
          '东营': [118.7073, 37.5513],
          '中山': [113.4229, 22.478],
          '临汾': [111.4783, 36.1615],
          '临沂': [118.3118, 35.2936],
          '丹东': [124.541, 40.4242],
          '丽水': [119.5642, 28.1854],
          '乌鲁木齐': [87.9236, 43.5883],
          '佛山': [112.8955, 23.1097],
          '保定': [115.0488, 39.0948],
          '兰州': [103.5901, 36.3043],
          '包头': [110.3467, 41.4899],
          '北京': [116.4551, 40.2539],
          '北海': [109.314, 21.6211],
          '南京': [118.8062, 31.9208],
          '南宁': [108.479, 23.1152],
          '南昌': [116.0046, 28.6633],
          '南通': [121.1023, 32.1625],
          '厦门': [118.1689, 24.6478],
          '台州': [121.1353, 28.6688],
          '合肥': [117.29, 32.0581],
          '呼和浩特': [111.4124, 40.4901],
          '咸阳': [108.4131, 34.8706],
          '哈尔滨': [127.9688, 45.368],
          '唐山': [118.4766, 39.6826],
          '嘉兴': [120.9155, 30.6354],
          '大同': [113.7854, 39.8035],
          '大连': [122.2229, 39.4409],
          '天津': [117.4219, 39.4189],
          '太原': [112.3352, 37.9413],
          '威海': [121.9482, 37.1393],
          '宁波': [121.5967, 29.6466],
          '宝鸡': [107.1826, 34.3433],
          '宿迁': [118.5535, 33.7775],
          '常州': [119.4543, 31.5582],
          '广州': [113.5107, 23.2196],
          '廊坊': [116.521, 39.0509],
          '延安': [109.1052, 36.4252],
          '张家口': [115.1477, 40.8527],
          '徐州': [117.5208, 34.3268],
          '德州': [116.6858, 37.2107],
          '惠州': [114.6204, 23.1647],
          '成都': [103.9526, 30.7617],
          '扬州': [119.4653, 32.8162],
          '承德': [117.5757, 41.4075],
          '拉萨': [91.1865, 30.1465],
          '无锡': [120.3442, 31.5527],
          '日照': [119.2786, 35.5023],
          '昆明': [102.9199, 25.4663],
          '杭州': [119.5313, 29.8773],
          '枣庄': [117.323, 34.8926],
          '柳州': [109.3799, 24.9774],
          '株洲': [113.5327, 27.0319],
          '武汉': [114.3896, 30.6628],
          '汕头': [117.1692, 23.3405],
          '江门': [112.6318, 22.1484],
          '沈阳': [123.1238, 42.1216],
          '沧州': [116.8286, 38.2104],
          '河源': [114.917, 23.9722],
          '泉州': [118.3228, 25.1147],
          '泰安': [117.0264, 36.0516],
          '泰州': [120.0586, 32.5525],
          '济南': [117.1582, 36.8701],
          '济宁': [116.8286, 35.3375],
          '海口': [110.3893, 19.8516],
          '淄博': [118.0371, 36.6064],
          '淮安': [118.927, 33.4039],
          '深圳': [114.5435, 22.5439],
          '清远': [112.9175, 24.3292],
          '温州': [120.498, 27.8119],
          '渭南': [109.7864, 35.0299],
          '湖州': [119.8608, 30.7782],
          '湘潭': [112.5439, 27.7075],
          '滨州': [117.8174, 37.4963],
          '潍坊': [119.0918, 36.524],
          '烟台': [120.7397, 37.5128],
          '玉溪': [101.9312, 23.8898],
          '珠海': [113.7305, 22.1155],
          '盐城': [120.2234, 33.5577],
          '盘锦': [121.9482, 41.0449],
          '石家庄': [114.4995, 38.1006],
          '福州': [119.4543, 25.9222],
          '秦皇岛': [119.2126, 40.0232],
          '绍兴': [120.564, 29.7565],
          '聊城': [115.9167, 36.4032],
          '肇庆': [112.1265, 23.5822],
          '舟山': [122.2559, 30.2234],
          '苏州': [120.6519, 31.3989],
          '莱芜': [117.6526, 36.2714],
          '菏泽': [115.6201, 35.2057],
          '营口': [122.4316, 40.4297],
          '葫芦岛': [120.1575, 40.578],
          '衡水': [115.8838, 37.7161],
          '衢州': [118.6853, 28.8666],
          '西宁': [101.4038, 36.8207],
          '西安': [109.1162, 34.2004],
          '贵阳': [106.6992, 26.7682],
          '连云港': [119.1248, 34.552],
          '邢台': [114.8071, 37.2821],
          '邯郸': [114.4775, 36.535],
          '郑州': [113.4668, 34.6234],
          '鄂尔多斯': [108.9734, 39.2487],
          '重庆': [107.7539, 30.1904],
          '金华': [120.0037, 29.1028],
          '铜川': [109.0393, 35.1947],
          '银川': [106.3586, 38.1775],
          '镇江': [119.4763, 31.9702],
          '长春': [125.8154, 44.2584],
          '长沙': [113.0823, 28.2568],
          '长治': [112.8625, 36.4746],
          '阳泉': [113.4778, 38.0951],
          '青岛': [120.4651, 36.3373],
          '韶关': [113.7964, 24.7028]
      };
      var BJData = [
          [{name: '北京'}, {name: '上海', value: 95}],
          [{name: '北京'}, {name: '广州', value: 90}],
          [{name: '北京'}, {name: '大连', value: 80}],
          [{name: '北京'}, {name: '南宁', value: 70}],
          [{name: '北京'}, {name: '南昌', value: 60}],
          [{name: '北京'}, {name: '拉萨', value: 50}],
          [{name: '北京'}, {name: '长春', value: 40}],
          [{name: '北京'}, {name: '包头', value: 30}],
          [{name: '北京'}, {name: '重庆', value: 20}],
          [{name: '北京'}, {name: '常州', value: 10}]
      ];
      var SHData = [
          [{name: '上海'}, {name: '包头', value: 95}],
          [{name: '上海'}, {name: '昆明', value: 90}],
          [{name: '上海'}, {name: '广州', value: 80}],
          [{name: '上海'}, {name: '郑州', value: 70}],
          [{name: '上海'}, {name: '长春', value: 60}],
          [{name: '上海'}, {name: '重庆', value: 50}],
          [{name: '上海'}, {name: '长沙', value: 40}],
          [{name: '上海'}, {name: '北京', value: 30}],
          [{name: '上海'}, {name: '丹东', value: 20}],
          [{name: '上海'}, {name: '大连', value: 10}]
      ];
      var GZData = [
          [{name: '广州'}, {name: '福州', value: 95}],
          [{name: '广州'}, {name: '太原', value: 90}],
          [{name: '广州'}, {name: '长春', value: 80}],
          [{name: '广州'}, {name: '重庆', value: 70}],
          [{name: '广州'}, {name: '西安', value: 60}],
          [{name: '广州'}, {name: '成都', value: 50}],
          [{name: '广州'}, {name: '常州', value: 40}],
          [{name: '广州'}, {name: '北京', value: 30}],
          [{name: '广州'}, {name: '北海', value: 20}],
          [{name: '广州'}, {name: '海口', value: 10}]
      ];
      var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
      var convertData = function (data) {
          var res = [];
          for (var i = 0; i < data.length; i++) {
              var dataItem = data[i];
              var fromCoord = geoCoordMap[dataItem[0].name];
              var toCoord = geoCoordMap[dataItem[1].name];
              if (fromCoord && toCoord) {
                  res.push({
                      fromName: dataItem[0].name,
                      toName: dataItem[1].name,
                      coords: [fromCoord, toCoord]
                  });
              }
          }
          return res;
      };
      var color = ['#a6c84c', '#ffa022', '#46bee9'];
      var series = [];
      [
          ['北京', BJData], ['上海', SHData], ['广州', GZData]].forEach(
          function (item, i) {
              series.push({
                      name: item[0] + ' Top10',
                      type: 'lines',
                      zlevel: 1,
                      effect: {
                          show: true,
                          period: 6,
                          trailLength: 0.7,
                          color: '#fff',
                          symbolSize: 3
                      },
                      lineStyle: {
                          normal: {
                              color: color[i],
                              width: 0,
                              curveness: 0.2
                          }
                      },
                      data: convertData(item[1])
                  },
                  {
                      name: item[0] + ' Top10',
                      type: 'lines',
                      zlevel: 2,
                      effect: {
                          show: true,
                          period: 6,
                          trailLength: 0,
                          symbol: planePath,
                          symbolSize: 15
                      },
                      lineStyle: {
                          normal: {
                              color: color[i],
                              width: 1,
                              opacity: 0.4,
                              curveness: 0.2
                          }
                      },
                      data: convertData(item[1])
                  },
                  {
                      name: item[0] + ' Top10',
                      type: 'effectScatter',
                      coordinateSystem: 'geo',
                      zlevel: 2,
                      rippleEffect: {
                          brushType: 'stroke'
                      },
                      label: {
                          normal: {
                              show: true,
                              position: 'right',
                              formatter: '{b}'
                          }
                      },
                      symbolSize: function (val) {
                          return val[2] / 8;
                      },
                      itemStyle: {
                          normal: {
                              color: color[i]
                          }
                      },
                      data: item[1].map(function (dataItem) {
                          return {
                              name: dataItem[1].name,
                              value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
                          };
                      })
                  });
          });
      return {
          tooltip: {
              trigger: 'item'
          },
          /*title: {
                             text: '模拟迁徙图',
                             subtext: '',
                             left: 'center',
                             textStyle: {
                                 color: '#fff'
                          }
                   },*/
          series: series
      };
  }
















  //添加Echarts图显示处理程序。
  var addEchartsBtn=document.getElementById('add-echarts-btn');
  var echartsLayer = null; // 声明一个全局变量来保存 ECharts 图层实例
  var echartsLayerVisible = false; // 声明一个变量来跟踪图层的显示状态
  addEchartsBtn.addEventListener('click', function() {
      if (!echartsLayerVisible) { // 如果图层未显示，则添加图层
          var data = [
              { name: '海门', value: 9 },
              { name: '鄂尔多斯', value: 12 },
              { name: '招远', value: 12 },
              { name: '舟山', value: 12 },
              { name: '齐齐哈尔', value: 14 },
              { name: '盐城', value: 15 },
              { name: '赤峰', value: 16 },
              { name: '青岛', value: 18 },
              { name: '乳山', value: 18 },
              { name: '金昌', value: 19 },
              { name: '泉州', value: 21 },
              { name: '莱西', value: 21 },
              { name: '日照', value: 21 },
              { name: '胶南', value: 22 },
              { name: '南通', value: 23 },
              { name: '拉萨', value: 24 },
              { name: '云浮', value: 24 },
              { name: '梅州', value: 25 },
              { name: '文登', value: 25 },
              { name: '上海', value: 25 },
              { name: '攀枝花', value: 25 },
              { name: '威海', value: 25 },
              { name: '承德', value: 25 },
              { name: '厦门', value: 26 },
              { name: '汕尾', value: 26 },
              { name: '潮州', value: 26 },
              { name: '丹东', value: 27 },
              { name: '太仓', value: 27 },
              { name: '曲靖', value: 27 },
              { name: '烟台', value: 28 },
              { name: '福州', value: 29 },
              { name: '瓦房店', value: 30 },
              { name: '即墨', value: 30 },
              { name: '抚顺', value: 31 },
              { name: '玉溪', value: 31 },
              { name: '张家口', value: 31 },
              { name: '阳泉', value: 31 },
              { name: '莱州', value: 32 },
              { name: '湖州', value: 32 },
              { name: '汕头', value: 32 },
              { name: '昆山', value: 33 },
              { name: '宁波', value: 33 },
              { name: '湛江', value: 33 },
              { name: '揭阳', value: 34 },
              { name: '荣成', value: 34 },
              { name: '连云港', value: 35 },
              { name: '葫芦岛', value: 35 },
              { name: '常熟', value: 36 },
              { name: '东莞', value: 36 },
              { name: '河源', value: 36 },
              { name: '淮安', value: 36 },
              { name: '泰州', value: 36 },
              { name: '南宁', value: 37 },
              { name: '营口', value: 37 },
              { name: '惠州', value: 37 },
              { name: '江阴', value: 37 },
              { name: '蓬莱', value: 37 },
              { name: '韶关', value: 38 },
              { name: '嘉峪关', value: 38 },
              { name: '广州', value: 38 },
              { name: '延安', value: 38 },
              { name: '太原', value: 39 },
              { name: '清远', value: 39 },
              { name: '中山', value: 39 },
              { name: '昆明', value: 39 },
              { name: '寿光', value: 40 },
              { name: '盘锦', value: 40 },
              { name: '长治', value: 41 },
              { name: '深圳', value: 41 },
              { name: '珠海', value: 42 },
              { name: '宿迁', value: 43 },
              { name: '咸阳', value: 43 },
              { name: '铜川', value: 44 },
              { name: '平度', value: 44 },
              { name: '佛山', value: 44 },
              { name: '海口', value: 44 },
              { name: '江门', value: 45 },
              { name: '章丘', value: 45 },
              { name: '肇庆', value: 46 },
              { name: '大连', value: 47 },
              { name: '临汾', value: 47 },
              { name: '吴江', value: 47 },
              { name: '石嘴山', value: 49 },
              { name: '沈阳', value: 50 },
              { name: '苏州', value: 50 },
              { name: '茂名', value: 50 },
              { name: '嘉兴', value: 51 },
              { name: '长春', value: 51 },
              { name: '胶州', value: 52 },
              { name: '银川', value: 52 },
              { name: '张家港', value: 52 },
              { name: '三门峡', value: 53 },
              { name: '锦州', value: 54 },
              { name: '南昌', value: 54 },
              { name: '柳州', value: 54 },
              { name: '三亚', value: 54 },
              { name: '自贡', value: 56 },
              { name: '吉林', value: 56 },
              { name: '阳江', value: 57 },
              { name: '泸州', value: 57 },
              { name: '西宁', value: 57 },
              { name: '宜宾', value: 58 },
              { name: '呼和浩特', value: 58 },
              { name: '成都', value: 58 },
              { name: '大同', value: 58 },
              { name: '镇江', value: 59 },
              { name: '桂林', value: 59 },
              { name: '张家界', value: 59 },
              { name: '宜兴', value: 59 },
              { name: '北海', value: 60 },
              { name: '西安', value: 61 },
              { name: '金坛', value: 62 },
              { name: '东营', value: 62 },
              { name: '牡丹江', value: 63 },
              { name: '遵义', value: 63 },
              { name: '绍兴', value: 63 },
              { name: '扬州', value: 64 },
              { name: '常州', value: 64 },
              { name: '潍坊', value: 65 },
              { name: '重庆', value: 66 },
              { name: '台州', value: 67 },
              { name: '南京', value: 67 },
              { name: '滨州', value: 70 },
              { name: '贵阳', value: 71 },
              { name: '无锡', value: 71 },
              { name: '本溪', value: 71 },
              { name: '克拉玛依', value: 72 },
              { name: '渭南', value: 72 },
              { name: '马鞍山', value: 72 },
              { name: '宝鸡', value: 72 },
              { name: '焦作', value: 75 },
              { name: '句容', value: 75 },
              { name: '北京', value: 79 },
              { name: '徐州', value: 79 },
              { name: '衡水', value: 80 },
              { name: '包头', value: 80 },
              { name: '绵阳', value: 80 },
              { name: '乌鲁木齐', value: 84 },
              { name: '枣庄', value: 84 },
              { name: '杭州', value: 84 },
              { name: '淄博', value: 85 },
              { name: '鞍山', value: 86 },
              { name: '溧阳', value: 86 },
              { name: '库尔勒', value: 86 },
              { name: '安阳', value: 90 },
              { name: '开封', value: 90 },
              { name: '济南', value: 92 },
              { name: '德阳', value: 93 },
              { name: '温州', value: 95 },
              { name: '九江', value: 96 },
              { name: '邯郸', value: 98 },
              { name: '临安', value: 99 },
              { name: '兰州', value: 99 },
              { name: '沧州', value: 100 },
              { name: '临沂', value: 103 },
              { name: '南充', value: 104 },
              { name: '天津', value: 105 },
              { name: '富阳', value: 106 },
              { name: '泰安', value: 112 },
              { name: '诸暨', value: 112 },
              { name: '郑州', value: 113 },
              { name: '哈尔滨', value: 114 },
              { name: '聊城', value: 116 },
              { name: '芜湖', value: 117 },
              { name: '唐山', value: 119 },
              { name: '平顶山', value: 119 },
              { name: '邢台', value: 119 },
              { name: '德州', value: 120 },
              { name: '济宁', value: 120 },
              { name: '荆州', value: 127 },
              { name: '宜昌', value: 130 },
              { name: '义乌', value: 132 },
              { name: '丽水', value: 133 },
              { name: '洛阳', value: 134 },
              { name: '秦皇岛', value: 136 },
              { name: '株洲', value: 143 },
              { name: '石家庄', value: 147 },
              { name: '莱芜', value: 148 },
              { name: '常德', value: 152 },
              { name: '保定', value: 153 },
              { name: '湘潭', value: 154 },
              { name: '金华', value: 157 },
              { name: '岳阳', value: 169 },
              { name: '长沙', value: 175 },
              { name: '衢州', value: 177 },
              { name: '廊坊', value: 193 },
              { name: '菏泽', value: 194 },
              { name: '合肥', value: 229 },
              { name: '武汉', value: 273 },
              { name: '大庆', value: 279 }
          ];
          var geoCoordMap = {
              '海门': [121.15, 31.89],
              '鄂尔多斯': [109.781327, 39.608266],
              '招远': [120.38, 37.35],
              '舟山': [122.207216, 29.985295],
              '齐齐哈尔': [123.97, 47.33],
              '盐城': [120.13, 33.38],
              '赤峰': [118.87, 42.28],
              '青岛': [120.33, 36.07],
              '乳山': [121.52, 36.89],
              '金昌': [102.188043, 38.520089],
              '泉州': [118.58, 24.93],
              '莱西': [120.53, 36.86],
              '日照': [119.46, 35.42],
              '胶南': [119.97, 35.88],
              '南通': [121.05, 32.08],
              '拉萨': [91.11, 29.97],
              '云浮': [112.02, 22.93],
              '梅州': [116.1, 24.55],
              '文登': [122.05, 37.2],
              '上海': [121.48, 31.22],
              '攀枝花': [101.718637, 26.582347],
              '威海': [122.1, 37.5],
              '承德': [117.93, 40.97],
              '厦门': [118.1, 24.46],
              '汕尾': [115.375279, 22.786211],
              '潮州': [116.63, 23.68],
              '丹东': [124.37, 40.13],
              '太仓': [121.1, 31.45],
              '曲靖': [103.79, 25.51],
              '烟台': [121.39, 37.52],
              '福州': [119.3, 26.08],
              '瓦房店': [121.979603, 39.627114],
              '即墨': [120.45, 36.38],
              '抚顺': [123.97, 41.97],
              '玉溪': [102.52, 24.35],
              '张家口': [114.87, 40.82],
              '阳泉': [113.57, 37.85],
              '莱州': [119.942327, 37.177017],
              '湖州': [120.1, 30.86],
              '汕头': [116.69, 23.39],
              '昆山': [120.95, 31.39],
              '宁波': [121.56, 29.86],
              '湛江': [110.359377, 21.270708],
              '揭阳': [116.35, 23.55],
              '荣成': [122.41, 37.16],
              '连云港': [119.16, 34.59],
              '葫芦岛': [120.836932, 40.711052],
              '常熟': [120.74, 31.64],
              '东莞': [113.75, 23.04],
              '河源': [114.68, 23.73],
              '淮安': [119.15, 33.5],
              '泰州': [119.9, 32.49],
              '南宁': [108.33, 22.84],
              '营口': [122.18, 40.65],
              '惠州': [114.4, 23.09],
              '江阴': [120.26, 31.91],
              '蓬莱': [120.75, 37.8],
              '韶关': [113.62, 24.84],
              '嘉峪关': [98.289152, 39.77313],
              '广州': [113.23, 23.16],
              '延安': [109.47, 36.6],
              '太原': [112.53, 37.87],
              '清远': [113.01, 23.7],
              '中山': [113.38, 22.52],
              '昆明': [102.73, 25.04],
              '寿光': [118.73, 36.86],
              '盘锦': [122.070714, 41.119997],
              '长治': [113.08, 36.18],
              '深圳': [114.07, 22.62],
              '珠海': [113.52, 22.3],
              '宿迁': [118.3, 33.96],
              '咸阳': [108.72, 34.36],
              '铜川': [109.11, 35.09],
              '平度': [119.97, 36.77],
              '佛山': [113.11, 23.05],
              '海口': [110.35, 20.02],
              '江门': [113.06, 22.61],
              '章丘': [117.53, 36.72],
              '肇庆': [112.44, 23.05],
              '大连': [121.62, 38.92],
              '临汾': [111.5, 36.08],
              '吴江': [120.63, 31.16],
              '石嘴山': [106.39, 39.04],
              '沈阳': [123.38, 41.8],
              '苏州': [120.62, 31.32],
              '茂名': [110.88, 21.68],
              '嘉兴': [120.76, 30.77],
              '长春': [125.35, 43.88],
              '胶州': [120.03336, 36.264622],
              '银川': [106.27, 38.47],
              '张家港': [120.555821, 31.875428],
              '三门峡': [111.19, 34.76],
              '锦州': [121.15, 41.13],
              '南昌': [115.89, 28.68],
              '柳州': [109.4, 24.33],
              '三亚': [109.511909, 18.252847],
              '自贡': [104.778442, 29.33903],
              '吉林': [126.57, 43.87],
              '阳江': [111.95, 21.85],
              '泸州': [105.39, 28.91],
              '西宁': [101.74, 36.56],
              '宜宾': [104.56, 29.77],
              '呼和浩特': [111.65, 40.82],
              '成都': [104.06, 30.67],
              '大同': [113.3, 40.12],
              '镇江': [119.44, 32.2],
              '桂林': [110.28, 25.29],
              '张家界': [110.479191, 29.117096],
              '宜兴': [119.82, 31.36],
              '北海': [109.12, 21.49],
              '西安': [108.95, 34.27],
              '金坛': [119.56, 31.74],
              '东营': [118.49, 37.46],
              '牡丹江': [129.58, 44.6],
              '遵义': [106.9, 27.7],
              '绍兴': [120.58, 30.01],
              '扬州': [119.42, 32.39],
              '常州': [119.95, 31.79],
              '潍坊': [119.1, 36.62],
              '重庆': [106.54, 29.59],
              '台州': [121.420757, 28.656386],
              '南京': [118.78, 32.04],
              '滨州': [118.03, 37.36],
              '贵阳': [106.71, 26.57],
              '无锡': [120.29, 31.59],
              '本溪': [123.73, 41.3],
              '克拉玛依': [84.77, 45.59],
              '渭南': [109.5, 34.52],
              '马鞍山': [118.48, 31.56],
              '宝鸡': [107.15, 34.38],
              '焦作': [113.21, 35.24],
              '句容': [119.16, 31.95],
              '北京': [116.46, 39.92],
              '徐州': [117.2, 34.26],
              '衡水': [115.72, 37.72],
              '包头': [110, 40.58],
              '绵阳': [104.73, 31.48],
              '乌鲁木齐': [87.68, 43.77],
              '枣庄': [117.57, 34.86],
              '杭州': [120.19, 30.26],
              '淄博': [118.05, 36.78],
              '鞍山': [122.85, 41.12],
              '溧阳': [119.48, 31.43],
              '库尔勒': [86.06, 41.68],
              '安阳': [114.35, 36.1],
              '开封': [114.35, 34.79],
              '济南': [117, 36.65],
              '德阳': [104.37, 31.13],
              '温州': [120.65, 28.01],
              '九江': [115.97, 29.71],
              '邯郸': [114.47, 36.6],
              '临安': [119.72, 30.23],
              '兰州': [103.73, 36.03],
              '沧州': [116.83, 38.33],
              '临沂': [118.35, 35.05],
              '南充': [106.110698, 30.837793],
              '天津': [117.2, 39.13],
              '富阳': [119.95, 30.07],
              '泰安': [117.13, 36.18],
              '诸暨': [120.23, 29.71],
              '郑州': [113.65, 34.76],
              '哈尔滨': [126.63, 45.75],
              '聊城': [115.97, 36.45],
              '芜湖': [118.38, 31.33],
              '唐山': [118.02, 39.63],
              '平顶山': [113.29, 33.75],
              '邢台': [114.48, 37.05],
              '德州': [116.29, 37.45],
              '济宁': [116.59, 35.38],
              '荆州': [112.239741, 30.335165],
              '宜昌': [111.3, 30.7],
              '义乌': [120.06, 29.32],
              '丽水': [119.92, 28.45],
              '洛阳': [112.44, 34.7],
              '秦皇岛': [119.57, 39.95],
              '株洲': [113.16, 27.83],
              '石家庄': [114.48, 38.03],
              '莱芜': [117.67, 36.19],
              '常德': [111.69, 29.05],
              '保定': [115.48, 38.85],
              '湘潭': [112.91, 27.87],
              '金华': [119.64, 29.12],
              '岳阳': [113.09, 29.37],
              '长沙': [113, 28.21],
              '衢州': [118.88, 28.97],
              '廊坊': [116.7, 39.53],
              '菏泽': [115.480656, 35.23375],
              '合肥': [117.27, 31.86],
              '武汉': [114.31, 30.52],
              '大庆': [125.03, 46.58]
          };

          var convertData = function(data) {
              var res = [];
              for (var i = 0; i < data.length; i++) {
                  var geoCoord = geoCoordMap[data[i].name];
                  if (geoCoord) {
                      res.push({
                          name: data[i].name,
                          value: geoCoord.concat(data[i].value)
                      });
                  }
              }
              return res;
          };

          var option = {
              title: {
                  text: '全国主要城市空气质量',
                  subtext: 'data from PM25.in',
                  sublink: 'http://www.pm25.in',
                  left: 'center'
              },
              series: [{
                  name: 'pm2.5',
                  type: 'scatter',
                  coordinateSystem: 'bmap',
                  data: convertData(data),
                  symbolSize: function(val) {
                      return val[2] / 10;
                  },
                  encode: {
                      value: 2
                  },
                  label: {
                      formatter: '{b}',
                      position: 'right',
                      show: false
                  },
                  itemStyle: {
                      color: 'yellow',
                  },
                  emphasis: {
                      label: {
                          show: true
                      }
                  }
              },
                  {
                      name: 'Top 5',
                      type: 'effectScatter',
                      data: convertData(data.sort(function(a, b) {
                          return b.value - a.value;
                      }).slice(0, 6)),
                      symbolSize: function(val) {
                          return val[2] / 10;
                      },
                      encode: {
                          value: 2
                      },
                      showEffectOn: 'render',
                      rippleEffect: {
                          brushType: 'stroke'
                      },
                      hoverAnimation: true,
                      label: {
                          formatter: '{b}',
                          position: 'right',
                          show: true
                      },
                      itemStyle: {
                          color: 'purple',
                          shadowBlur: 10,
                          shadowColor: '#333'
                      },
                      zlevel: 1
                  }
              ]
          };
          addEchartsBtn.textContent = '-'; // 当表格隐藏时，按钮文本变成加号
          echartsLayer = new ol3Echarts(option);
          echartsLayer.appendTo(map);
          echartsLayerVisible = true; // 设置图层显示状态为 true
      } else { // 如果图层已显示，则移除图层
          echartsLayer.remove();
          echartsLayerVisible = false; // 设置图层显示状态为 false

          addEchartsBtn.textContent = '+'; // 当表格显示时，按钮文本变成减号



      }
  });


  function drawFlightRoute() {
    var lineStyle = new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'blue',
        width: 2
      })
    });

    var line = new ol.geom.LineString([startPoint.getGeometry().getCoordinates(), endPoint.getGeometry().getCoordinates()]);
    lineFeature = new ol.Feature({
      geometry: line
    });
    lineFeature.setStyle(lineStyle);

    var vectorSource = new ol.source.Vector({
      features: [lineFeature]
    });

    var vectorLayer = new ol.layer.Vector({
      source: vectorSource
    });

    map.addLayer(vectorLayer);
  }

  function animatePlane() {
    var planeStyle = new ol.style.Style({
      image: new ol.style.Icon({
        anchor: [0.5, 0.5],
        src: 'https://zzh-1318584129.cos.ap-nanjing.myqcloud.com/plane.png',
        scale: 0.05,
        rotateWithView: true
      })
    });

    var lineCoordinates = lineFeature.getGeometry().getCoordinates();
    var pathLength = new ol.geom.LineString(lineCoordinates).getLength();
    distance = new ol.geom.LineString([startPoint.getGeometry().getCoordinates(), endPoint.getGeometry().getCoordinates()]).getLength();
    // document.getElementById('distance-info').innerHTML = "飞行距离: " + distance.toFixed(2) + " 米";
    var planeCoord = lineCoordinates[0];
    var i = 0;

    function animate() {
      if (i < pathLength) {
        planeCoord = new ol.geom.LineString(lineCoordinates).getCoordinateAt(i / pathLength);
        planeFeature.setGeometry(new ol.geom.Point(planeCoord));
        i += 100;
        requestAnimationFrame(animate);
      }
    }

    planeFeature = new ol.Feature({
      geometry: new ol.geom.Point(planeCoord)
    });
    planeFeature.setStyle(planeStyle);

    var vectorSource = new ol.source.Vector({
      features: [planeFeature]
    });

    var vectorLayer = new ol.layer.Vector({
      source: vectorSource
    });

    map.addLayer(vectorLayer);

    animate();
  }

  function clearFlight() {
    if (lineFeature) {
      map.removeLayer(lineFeature);
      lineFeature = null;
    }
    if (planeFeature) {
      map.removeLayer(planeFeature);
      planeFeature = null;
    }
    startPoint = null;
    endPoint = null;
  }

  // 在地图上点击事件监听器
  map.on('click', function(event) {
    var clickedCoordinate = event.coordinate;
    if (!startPoint) {
      // 如果起点为空，则将点击的坐标作为起点
      startPoint = addPoint(clickedCoordinate, true);
    } else if (!endPoint) {
      // 如果终点为空，则将点击的坐标作为终点，并绘制飞行路线，然后开始飞行动画
      endPoint = addPoint(clickedCoordinate, false);
      drawFlightRoute();
      animatePlane();
    } else {
      // 如果起点和终点都已设置，则清除上一次的飞行信息，并重新设置新的起点
      clearFlight();
      startPoint = addPoint(clickedCoordinate, true);
    }
  });

  function flyToDestination() {
    locationInput = document.getElementById('location-input').value;
    var geocoder = new BMap.Geocoder();
    geocoder.getPoint(locationInput, function(point) {
      if (point) {
        var coordinates = ol.proj.fromLonLat([point.lng, point.lat]);
        // displayLocation(coordinates);
        console.log(coordinates);
        var duration = 2000;
        map.getView().animate({
          center: coordinates,
          duration: duration
        });
      } else {
        console.error('Geocode was not successful.');
      }
    }, '武汉市'); // 这里可以设置默认城市
  }

  map.addControl(overviewMap);
  //******************************

  // 使用AJAX请求后端数据，得到所有点的信息
  var xhr = new XMLHttpRequest();
  xhr.open('GET', src_loc+':9090//location/getAllLocations', true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      var response = JSON.parse(xhr.responseText);
      if (Array.isArray(response.data)) {
        locations = response.data;
        drawPoints(locations);
        renderPage(currentPage);
      } else {
        console.error("Locations data is not an array:", response);
      }
    }
  };

  xhr.send();

  /**
   * 根据后端数据在地图上打点
   * @param locations 后端返回的位置信息数组
   */
  //绘制所有点函数
  function drawPoints(locations) {
    // Clear existing layers
    map.getLayers().forEach(function(layer) {
      if (layer instanceof ol.layer.Vector) {
        map.removeLayer(layer);
      }
    });

    locations.forEach(function(location) {
      var lonLat = ol.proj.transform([location.longitude, location.latitude], 'EPSG:4326', 'EPSG:3857');
      var feature = new ol.Feature({
        geometry: new ol.geom.Point(lonLat),
        // 在 feature 中添加属性，存储经纬度信息
        longitude: location.longitude,
        latitude: location.latitude
      });

      style = new ol.style.Style({
        image: new ol.style.Icon({
          scale: 0.15,
          src: 'https://zzh-1318584129.cos.ap-nanjing.myqcloud.com/%E5%AE%9A%E4%BD%8D.png',
          anchor: [0.48, 0.52]
        }),
        text: new ol.style.Text({
          font: 'normal 12px 黑体',
          textAlign: 'center',
          textBaseline: 'middle',
          offsetY: -35,
          offsetX: 0,
          backgroundFill: new ol.style.Stroke({
            color: 'rgba(0,0,255,0.7)',
          }),
          fill: new ol.style.Fill({
            color: 'rgba(236,218,20,1)'
          }),
          padding: [5, 5, 5, 5],
          text: location.community,
        })
      });

      feature.setStyle(style);
      map.addLayer(new ol.layer.Vector({
        source: new ol.source.Vector({
          features: [feature]
        })
      }));
      featureArray.push(feature);
    });

    // 监听地图上的鼠标移动事件
    map.on('pointermove', function(event) {
      // 获取鼠标位置下的要素
      var feature = map.forEachFeatureAtPixel(event.pixel, function(feature) {
        return feature;
      });

      // 如果存在要素，则显示该要素的经纬度信息
      if (feature) {
        // 从 feature 的属性中获取经纬度信息
        var longitude = feature.get('longitude');
        // var community = feature.get('community');
        var latitude = feature.get('latitude');
        // console.log(feature);
        // 在这里你可以自定义展示经纬度信息的样式和格式
        var infoBox = document.getElementById('infoBox');
        infoBox.innerHTML = '<br><b>经度:</b> ' + longitude.toFixed(6) + '<br><b>纬度:</b> ' + latitude.toFixed(6)+'<br><b>地点介绍:</b>';
        infoBox.style.display = 'block';
        infoBox.style.left = (event.pixel[0] + 10) + 'px'; // 设置信息框相对于鼠标的位置偏移
        infoBox.style.top = (event.pixel[1] - 20) + 'px'; // 设置信息框相对于鼠标的位置偏移

      } else {
        // 如果不存在要素，则隐藏信息框
        var infoBox = document.getElementById('infoBox');
        infoBox.style.display = 'none';
      }
    });
  }

  function zzh(locateButton)
  {
    locateButton.style.border = 'none'; // 设置按钮边框样式
    locateButton.style.color = 'white'; // 设置按钮文字颜色
    locateButton.style.padding = '5px 10px'; // 设置按钮内边距
    locateButton.style.textAlign = 'center'; // 设置按钮文字居中
    locateButton.style.textDecoration = 'none'; // 设置文字无下划线
    locateButton.style.display = 'inline-block'; // 设置按钮显示为行内块元素
    locateButton.style.fontSize = '16px'; // 设置文字大小
    locateButton.style.margin = '4px 2px'; // 设置按钮外边距
    locateButton.style.cursor = 'pointer'; // 设置鼠标样式为手型
    locateButton.style.borderRadius = '10px'; // 设置按钮圆角
    locateButton.style.transitionDuration = '0.4s'; // 设置过渡动画时长
    locateButton.style.marginRight = '10px';
    return locateButton;
  }
  /**
   * Render current page of data in the table
   * @param page Page number to render
   */
  //页面刷新函数
  function renderPage(page) {
    var startIndex = (page - 1) * itemsPerPage;
    var endIndex = startIndex + itemsPerPage;
    var totalPages = Math.ceil(locations.length / itemsPerPage);
    var dataToShow = locations.slice(startIndex, endIndex);

    // Clear table body
    var tableBody = document.getElementById('data-table-body');
    tableBody.innerHTML = '';

    // Populate table with data
    dataToShow.forEach(function(location) {
      var row = document.createElement('tr');
      var communityCell = document.createElement('td');
      communityCell.textContent = location.community;
      row.appendChild(communityCell);
      var longitudeCell = document.createElement('td');
      longitudeCell.textContent = location.longitude;
      row.appendChild(longitudeCell);
      var latitudeCell = document.createElement('td');
      latitudeCell.textContent = location.latitude;
      row.appendChild(latitudeCell);

      // Adding action buttons
      var actionCell = document.createElement('td');
      var locateButton = document.createElement('button');
      locateButton.textContent = '定位'; // 设置按钮文本内容
      locateButton.style.backgroundColor = 'blue'; // 设置按钮背景颜色
      zzh(locateButton)


      locateButton.addEventListener('click', function() {
        // Write your code to center the map to this location
        var lonLat = ol.proj.transform([parseFloat(longitudeCell.textContent), parseFloat(latitudeCell.textContent)], 'EPSG:4326', 'EPSG:3857');
        map.getView().setCenter(lonLat);
        var lon = parseFloat(longitudeCell.textContent);
        var lat = parseFloat(latitudeCell.textContent);
        if (selectedFeature !== null) {
          selectedFeature.setStyle(originalStyle);
        }

        // 遍历 featureArray，找到对应的特征对象并更改其图标样式
        for (var i = 0; i < featureArray.length; i++) {
          var feature = featureArray[i];
          // 判断特征对象的经纬度是否与当前位置匹配
          if (feature.get('longitude') === lon && feature.get('latitude') === lat) {
            // 保存当前选中的特征对象和样式
            selectedFeature = feature;
            originalStyle = feature.getStyle();

            // 创建新的样式对象
            var newStyle = new ol.style.Style({
              image: new ol.style.Icon({
                scale: 0.16,
                src: 'https://zzh-1318584129.cos.ap-nanjing.myqcloud.com/ding.png',
                anchor: [0.48, 0.52]
              }),
              text: feature.getStyle().getText() // 保持文本样式不变
            });
            // 设置新的样式对象到特征对象
            feature.setStyle(newStyle);

            // 停止循环，因为已经找到了匹配的特征对象
            break;
          }
        }
      });

      actionCell.appendChild(locateButton);

      var editButton = document.createElement('button');
      editButton.textContent = '编辑'; // 设置按钮文本内容
      editButton.style.backgroundColor = 'orange'; // 设置按钮背景颜色
      zzh(editButton)
      editButton.addEventListener('click', function() {
        // Open modal for editing this location
        openEditModal(location);
      });
      actionCell.appendChild(editButton);

      var deleteButton = document.createElement('button');
      deleteButton.textContent = '删除';
      deleteButton.style.backgroundColor = 'red'; // 设置按钮背景颜色
      zzh(deleteButton)
      deleteButton.addEventListener('click', function() {
        // Write your code to delete this location and refresh the page
        // var index = locations.indexOf(location);
        // if (index !== -1) {
        //     locations.splice(index, 1);
        //     renderPage(currentPage);
        // }
        // Write your code to delete this location and refresh the page
        // 获取当前行的社区名信息
        var communityName = communityCell.textContent;

        // 在这里编写删除操作的代码，例如使用AJAX请求将该位置从数据库中删除
        // 删除完成后，更新locations数组，将该位置从数组中移除
        // 最后调用renderPage(currentPage)刷新页面
        // 例如，可以弹出一个确认框来确认删除操作
        var confirmDelete = confirm("确认删除该位置信息吗？");
        if (confirmDelete) {
          // 从前端移除该行数据
          var tableRow = row.parentNode;
          tableRow.removeChild(row);

          // 从 locations 数组中移除对应的数据
          var index = locations.findIndex(function(location) {
            return location.community === communityName;
          });
          if (index !== -1) {
            locations.splice(index, 1);
            // 可以在这里进行 AJAX 请求，将删除操作发送到后端
            // 删除完成后，可以刷新页面或其他操作
            // 向后端发送删除请求
            deleteLocation(communityName);
          }
        }

      });
      actionCell.appendChild(deleteButton);

      row.appendChild(actionCell);

      tableBody.appendChild(row);
    });

    // Update pagination controls
    var currentPageElement = document.getElementById('current-page');
    currentPageElement.textContent = page;
    var totalPageElement = document.getElementById('total-pages');
    totalPageElement.textContent = totalPages;

    // Enable/disable previous and next buttons based on current page
    var prevButton = document.getElementById('prev-page');
    var nextButton = document.getElementById('next-page');
    prevButton.disabled = page === 1;
    nextButton.disabled = page === totalPages;
  }

  // Function to open the edit modal with location data
  function openEditModal(location) {
    // Fill form fields with location data
    document.getElementById('editCommunity').value = location.community;
    document.getElementById('editLongitude').value = location.longitude;
    document.getElementById('editLatitude').value = location.latitude;

    // Show modal
    var modal = document.getElementById('editModal');
    modal.style.display = 'block';

    // Set the location id to use for updating
    editedLocationId = location.id;
  }

  //点击新增按钮，弹出弹窗
  // var addBtn = document.getElementById('add-button');
  // addBtn.addEventListener('click', function() {
  //   var modal = document.getElementById('addModal');
  //   modal.style.display = 'block';
  //
  // });

  //点击新增弹窗右上角“×”，关闭弹窗
  var addModal = document.getElementById('addModal'); // 获取新增模态框
  var addCloseBtn = addModal.getElementsByClassName('close')[0]; // 获取新增模态框中的关闭按钮
  addCloseBtn.onclick = function() {
    addModal.style.display = 'none'; // 点击关闭按钮时，隐藏新增模态框
  };

  // 点击编辑弹窗右上角“×”，关闭弹窗
  var modal = document.getElementById('editModal');
  var span = document.getElementsByClassName('close')[0];
  span.onclick = function() {
    modal.style.display = 'none';
  };

  //点击新增或编辑弹窗区域外，关闭弹窗
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = 'none';//关闭编辑弹窗

    }
    // if(event.target==addModal)
    // {
    //   addModal.style.display = 'none';//关闭新增弹窗
    // }
  };

  //处理更新信息的弹窗
  document.getElementById('editForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form submission

    // Get updated location data from form
    var updatedCommunity = document.getElementById('editCommunity').value;
    var updatedLongitude = document.getElementById('editLongitude').value;
    var updatedLatitude = document.getElementById('editLatitude').value;

    // Create data object to send via AJAX
    var data = {
      id: editedLocationId,
      community: updatedCommunity,
      longitude: updatedLongitude,
      latitude: updatedLatitude
    };
    updateLocation(data);
  });

  //编辑信息函数，与后端交互
  function updateLocation(data)
  {
    // Send AJAX request to update location
    var xhr = new XMLHttpRequest();
    xhr.open('POST', src_loc + ':9090/location/updateLocation', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          console.log("位置信息更新成功");
          // Close the modal
          modal.style.display = 'none';
          console.log("xiao->");
          var updatedLocationIndex = locations.findIndex(function(loc) {
            return loc.id === data.id;
          });
          if (updatedLocationIndex !== -1) {
            // Update the location object with new data
            locations[updatedLocationIndex].community = data.community;
            locations[updatedLocationIndex].longitude = data.longitude;
            locations[updatedLocationIndex].latitude = data.latitude;
          }
          // Refresh the page
          renderPage(currentPage);
          // Redraw points on the map
          drawPoints(locations);
          // Center map to updated location
          var updatedLocation = locations.find(function(loc) {
            return loc.id === data.id;
          });
          if (updatedLocation) {
            var lonLat = ol.proj.transform([updatedLocation.longitude, updatedLocation.latitude], 'EPSG:4326', 'EPSG:3857');
            map.getView().setCenter(lonLat);
          }
        } else {
          console.error("位置信息更新失败:", xhr.statusText);
        }
      }
    };
    xhr.send(JSON.stringify(data));
  }

  //处理新增小区弹窗的提交
  // document.getElementById('addForm').addEventListener('submit', function(event) {
  //   event.preventDefault();
  //   var addCommunity = document.getElementById('addCommunity').value;
  //   var addLongitude = document.getElementById('addLongitude').value;
  //   var addLatitude = document.getElementById('addLatitude').value;
  //   var newLocation = {
  //     community: addCommunity,
  //     longitude: addLongitude,
  //     latitude: addLatitude
  //   };
  //   addNewLocation(newLocation);
  //   var modal = document.getElementById('addModal');
  //   modal.style.display = 'none';
  // });

  //新增小区信息，与后端交互
  function addNewLocation(location) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', src_loc+':9090//location/addLocation', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
        console.log("小区增加成功");
        console.log("jjj");
        locations.push(location);
        drawPoints(locations);
        renderPage(currentPage);
        var lonLat = ol.proj.transform([location.longitude, location.latitude], 'EPSG:4326', 'EPSG:3857');
        map.getView().setCenter(lonLat);
      }
      else {
        console.error("Error adding location:", response);
      }
    };
    xhr.send(JSON.stringify(location));
  }

  // 删除位置信息从后端
  function deleteLocation(communityName) {
    console.log('Deleting location:', communityName);
    var xhr = new XMLHttpRequest();
    console.log('XHR object:', xhr);
    // var xhr = new XMLHttpRequest();
    xhr.open('POST', src_loc+':9090/location/deleteLocation', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          console.log("位置信息删除成功");
          // 刷新页面**********
          renderPage(currentPage);
          // 重新绘制地图上的点标记
          var xhrGetLocations = new XMLHttpRequest();
          xhrGetLocations.open('GET', src_loc+':9090//location/getAllLocations', true);
          xhrGetLocations.onreadystatechange = function() {
            if (xhrGetLocations.readyState === 4 && xhrGetLocations.status === 200) {
              var response = JSON.parse(xhrGetLocations.responseText);
              if (Array.isArray(response.data)) {
                locations = response.data;
                drawPoints(locations);
                renderPage(currentPage);
              } else {
                console.error("Locations data is not an array:", response);
              }
            }
          };

          xhrGetLocations.send();

          drawPoints(locations);
          // // 设置地图中心为更新后的位置
          var updatedLocation = locations.find(function(location) {
            return location.community === newCommunityName;
          });
          if (updatedLocation) {
            var lonLat = ol.proj.transform([updatedLocation.longitude, updatedLocation.latitude], 'EPSG:4326', 'EPSG:3857');
            map.getView().setCenter(lonLat);
          }
        } else {
          console.error("位置信息删除失败:", xhr.statusText);
        }
      }
    };
    var data = 'community=' + encodeURIComponent(communityName);
    xhr.send(data);
  }

  var layerSelect = document.getElementById('layerSelect');
  var layers = map.getLayers().getArray();
  for (var i = 0; i < layers.length; i++) {
    var layer = layers[i];
    var option = document.createElement('option');
    option.value = layer.get('title');
    option.text = layer.get('title');
    layerSelect.appendChild(option);
  }
  //改变地图图层
  function changeLayer() {
    var selectedLayer = layerSelect.value;
    var layers = map.getLayers().getArray();
    for (var i = 0; i < layers.length; i++) {
      var layer = layers[i];
      if (layer.get('title') === selectedLayer) {
        layer.setVisible(true);
      } else {
        layer.setVisible(false);
      }
      drawPoints(locations);
    }
  }

  layerSelect.addEventListener('change', function() {
    var selectedLayer = layerSelect.value;
    var overviewLayers = overviewMapControl.getOverviewMap().getLayers().getArray();
    for (var i = 0; i < overviewLayers.length; i++) {
      var layer = overviewLayers[i];
      if (layer.get('title') === selectedLayer) {
        layer.setVisible(true);
      } else {
        layer.setVisible(false);
      }
    }
  
    var overmapLayers = overviewMap.getOverviewMap().getLayers().getArray();
    for (var i = 0; i < overmapLayers.length; i++) {
      var layer = overmapLayers[i];
      if (layer.get('title') === selectedLayer) {
        layer.setVisible(true);
      } else {
        layer.setVisible(false);
      }
    }
  });

  // Pagination event listeners
  document.getElementById('prev-page').addEventListener('click', function() {
    if (currentPage > 1) {
      currentPage--;
      renderPage(currentPage);
    }
  });

  document.getElementById('next-page').addEventListener('click', function() {
    if (currentPage < Math.ceil(locations.length / itemsPerPage)) {
      currentPage++;
      renderPage(currentPage);
    }
  });

  document.getElementById('items-per-page').addEventListener('change', function() {
    itemsPerPage = parseInt(this.value);
    currentPage = 1;
    renderPage(currentPage);
  });
</script>

</body>
</html>
